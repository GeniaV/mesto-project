(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"21f5d387-3585-4f45-9a38-eaba49ddcf0b","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject(new Error("Произошлоа Ошибка: ".concat(e.status)))},n=function(){return fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return t(e)})).catch((function(e){return console.log(e),Promise.reject(e)}))},o=function(){return fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return t(e)})).catch((function(e){return console.log(e),Promise.reject(e)}))};Promise.all([n(),o]).then((function(e){})).catch((function(e){return console.log(e),Promise.reject(e)}));var r=document.querySelector(".popup__form"),c=document.querySelector(".profile__name"),a=r.querySelector("#profile-name"),u=document.querySelector(".profile__profession"),i=r.querySelector("#profile-profession"),l=document.querySelector(".popup_type_profile");document.querySelector(".popup_type_image");var s=document.querySelector(".popup_type_update-avatar"),p=document.querySelector(".popup__form_type_update-avatar"),d=p.querySelector("#place-avatarlink"),f=document.querySelector(".profile__avatar");function _(e){"Escape"===e.key&&v(document.querySelector(".popup_opened"))}function m(e){var t=e.querySelectorAll(".popup__input-style"),n=e.querySelectorAll(".popup__input-error");t.forEach((function(e){e.classList.remove("popup__input-style_type_error")})),n.forEach((function(e){e.classList.remove("popup__input-error_active")}))}function y(e){document.addEventListener("keydown",_),e.classList.add("popup_opened")}function v(e){document.removeEventListener("keydown",_),e.classList.remove("popup_opened")}n().then((function(e){f.src=e.avatar,c.textContent=e.name,u.textContent=e.about})).catch((function(e){console.log("Ошибка при загрузке аватара",e.message)}));var h=["inputSelector","submitButtonSelector","inactiveButtonClass"];function S(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},c=Object.keys(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var b=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)};function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var q=document.querySelector(".popup__photo-large"),C=document.querySelector("#card-template").content,L=document.querySelector(".popup__photo-caption"),k=document.querySelector(".popup_type_image");function E(o){var r=C.querySelector(".card").cloneNode(!0),c=r.querySelector(".card__delete-icon"),a=r.querySelector(".card__like-icon"),u=r.querySelector(".card__name"),i=r.querySelector(".card__image"),l=r.querySelector(".card__likes-counter");return u.textContent=o.name,i.alt=o.name,i.src=o.link,l.textContent=o.likes.length,n().then((function(e){var t=e._id;o.likes.forEach((function(e){e._id===t&&(a.classList.add("card__like-icon_like"),l.textContent)})),o.owner._id!==t&&(c.style.display="none")})).catch((function(e){console.log("Ошибка",e.message)})),i.addEventListener("click",(function(){y(k),q.src=i.src,q.alt=i.alt,L.textContent=u.textContent})),a.addEventListener("click",(function(){var n,r=Number(l.textContent);a.classList.contains("card__like-icon_like")?function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)})).catch((function(e){return console.log(e),Promise.reject(e)}))}(o._id).then((function(e){a.classList.remove("card__like-icon_like"),l.textContent=r-1})).catch((function(e){console.log("Ошибка удаления лайка",e.message)})):(n=o._id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then((function(e){return t(e)})).catch((function(e){return console.log(e),Promise.reject(e)}))).then((function(e){a.classList.add("card__like-icon_like"),l.textContent=r+1})).catch((function(e){console.log("Ошибка проствления лайка",e.message)}))})),c.addEventListener("click",(function(n){var r;(r=o._id,fetch("".concat(e.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)})).catch((function(e){return console.log(e),Promise.reject(e)}))).then((function(e){!function(e){e.target.closest(".card").remove()}(n)})).catch((function(e){console.log("Ошибка удаления карточки",e.message)}))})),r}var x=document.querySelector(".popup__form_type_new-card"),j=document.querySelector(".places-gallery"),P=x.querySelector("#place-name"),A=x.querySelector("#place-link"),O=document.querySelector(".popup_type_new-card");o().then((function(e){var t,n=e.map((function(e){return E(e)}));j.prepend.apply(j,function(e){if(Array.isArray(e))return g(e)}(t=n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})).catch((function(e){console.log("Ошибка при загрузке карточек",e.message)}));var w,U,T,B=document.querySelector(".profile__edit-button"),D=document.querySelector(".profile__add-button"),N=document.querySelector(".profile__avatar-container");B.addEventListener("click",(function(){y(l),m(l),a.value=c.textContent,i.value=u.textContent;var e=l.querySelector(".popup__button");e.classList.remove("popup__button_disabled"),e.disabled=!1})),D.addEventListener("click",(function(){y(O),m(O),P.value="",A.value=""})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup_opened")&&v(e),t.target.classList.contains("popup__close-button")&&v(e)}))})),r.addEventListener("submit",(function(n){n.preventDefault();var o,s,p,d=r.querySelector(".popup__button");d.textContent="Сохранение...",(o={name:a.value,about:i.value},s=o.name,p=o.about,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:s,about:p})}).then((function(e){return t(e)})).catch((function(e){return console.log(e),Promise.reject(e)}))).then((function(e){c.textContent=a.value,u.textContent=i.value})).catch((function(e){console.log("Ошибка редактирования профиля",e.message)})).finally((function(){d.textContent="Сохранить"})),v(l)})),x.addEventListener("submit",(function(n){var o=O.querySelector(".popup__button");o.textContent="Сохранение...",n.preventDefault();var r,c,a,u=C.querySelector(".card").cloneNode(!0).querySelector(".card__likes-counter");(r={name:P.value,link:A.value,likes:u.textContent},c=r.name,a=r.link,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:c,link:a})}).then((function(e){return t(e)})).catch((function(e){return console.log(e),Promise.reject(e)}))).then((function(e){j.prepend(E(e))})).catch((function(e){console.log("Ошибка добавления карточки на сервер",e.message)})).finally((function(){o.textContent="Создать"})),v(O),o.classList.add("popup__button_disabled"),o.disabled=!0})),N.addEventListener("click",(function(){y(s),d.value="",m(s);var e=s.querySelector(".popup__button");e.classList.add("popup__button_disabled"),e.disabled=!0})),p.addEventListener("submit",(function(n){n.preventDefault();var o=s.querySelector(".popup__button");o.textContent="Сохранение...",function(n){var o=n.avatar;return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then((function(e){return t(e)})).catch((function(e){return console.log(e),Promise.reject(e)}))}({avatar:d.value}).then((function(e){f.src=d.value})).catch((function(e){console.log("Ошибка редактирования фото профиля",e.message)})).finally((function(){o.textContent="Сохранить"})),v(s)})),U=(w={formSelector:".popup__form",inputSelector:".popup__input-style",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input-style_type_error",errorClass:"popup__input-error_active"}).formSelector,T=S(w,["formSelector"]),Array.from(document.querySelectorAll(U)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=t.inputSelector,o=t.submitButtonSelector,r=t.inactiveButtonClass,c=S(t,h),a=Array.from(e.querySelectorAll(n)),u=e.querySelector(o);b(a,u,r),a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=n.inputErrorClass,r=n.errorClass,c=e.querySelector(".".concat(t.id,"-input-error"));t.classList.remove(o),c.classList.remove(r),c.textContent=""}(e,t,n):function(e,t,n,o){var r=o.inputErrorClass,c=o.errorClass,a=e.querySelector(".".concat(t.id,"-input-error"));t.classList.add(r),a.textContent=n,a.classList.add(c)}(e,t,t.validationMessage,n)}(e,t,c),b(a,u,r)}))}))}(e,T)}))})();